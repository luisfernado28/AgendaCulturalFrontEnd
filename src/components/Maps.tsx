/*
 * File: Maps.tsx
 * Project: Agenda Cultural Front End React
 * Author: Luis Fernando Choque (luisfernandochoquea@gmail.com)
 * -----
 * Copyright 2021 - 2022 Universidad Privada Boliviana La Paz, Luis Fernando Choque Arana
 */
import React from "react";
import { GoogleMap, useJsApiLoader } from "@react-google-maps/api";
import { Marker } from "@react-google-maps/api";
import { useMediaQuery } from "@mui/material";

interface MapProps {
	markerCoordinates: number[];
	type: string; //Infromative or Picker
	valueOfLocal: Function;
}

const center = {
	lat: -16.49542163483714,
	lng: -68.13353376825822,
};
const Maps = (props: MapProps): JSX.Element => {
	const matchesMinWidh600 = useMediaQuery("(min-width:600px)");

	const containerStyle = {
		width: matchesMinWidh600 ? "400px" : "330px",
		height: matchesMinWidh600 ? "400px" : "300px",
	};
	const [map, setMap] = React.useState(null);
	const [marker, setmarker] = React.useState({
		lat: props.markerCoordinates[0],
		lng: props.markerCoordinates[1],
	});
	let mapsAPI: string;

	if (process.env.REACT_APP_MAPS_API !== undefined) {
		mapsAPI = process.env.REACT_APP_MAPS_API;
	}
	const { isLoaded } = useJsApiLoader({
		id: "google-map-script",
		googleMapsApiKey: mapsAPI,
	});

	const onLoad2 = (marker) => {
	};

	const onLoad = React.useCallback(function callback(map) {
		const bounds = new window.google.maps.LatLngBounds(center);
		// map.fitBounds(bounds);
		setMap(map);
	}, []);

	const onUnmount = React.useCallback(function callback(map) {
		setMap(null);
	}, []);

	if (props.type === "Picker") {
		const onClick = (e: google.maps.LatLng) => {
			setmarker({ lat: e.lat(), lng: e.lng() });
			props.valueOfLocal(e);
		};
		return isLoaded ? (
			<GoogleMap
				mapContainerStyle={containerStyle}
				center={center}
				zoom={11}
				onLoad={onLoad}
				onUnmount={onUnmount}
				onClick={(e: google.maps.MapMouseEvent) => {
					onClick(e.latLng);
				}}
			>
				{marker ? (
					<Marker onLoad={onLoad2} position={marker} />
				) : (
					<div></div>
				)}
			</GoogleMap>
		) : (
			<></>
		);
	} else {
		let showMarker = false;
		const position = {
			lat: -16.49542163483714,
			lng: -68.13353376825822,
		};
		if (props.markerCoordinates !== []) {
			showMarker = true;

			position.lat = props.markerCoordinates[0];
			position.lng = props.markerCoordinates[1];
		}
		return isLoaded ? (
			<GoogleMap
				mapContainerStyle={containerStyle}
				center={center}
				zoom={11}
				onLoad={onLoad}
				onUnmount={onUnmount}
				onClick={(e: any) => {
					console.log(e);
				}}
			>
				{showMarker ? (
					<Marker onLoad={onLoad2} position={position} />
				) : (
					<div>bbbbbbbbbbbbbbbbbbbbbb</div>
				)}
			</GoogleMap>
		) : (
			<></>
		);
	}
};
export default Maps;
